name: Basic Validation

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
    
    - name: Basic file check
      run: |
        echo "=== åŸºç¡€æ–‡ä»¶æ£€æŸ¥ ==="
        
        # æ£€æŸ¥æˆ‘ä»¬ç¡®å®æœ‰çš„æ–‡ä»¶
        echo "1. æ£€æŸ¥å¿…éœ€æ–‡ä»¶..."
        files_to_check=(
          "README.md"
          ".gitignore"
          "LICENSE"
          ".env.example"
          "docker-compose.yml"
          ".github/workflows/ci-correct.yml"
          ".github/workflows/basic-validation.yml"
        )
        
        all_exist=true
        for file in "${files_to_check[@]}"; do
          if [ -f "$file" ]; then
            echo "âœ… $file"
          else
            echo "âŒ $file (ä¸å­˜åœ¨)"
            all_exist=false
          fi
        done
        
        echo ""
        echo "2. æ–‡ä»¶å†…å®¹æ£€æŸ¥..."
        
        # æ£€æŸ¥README.mdä¸æ˜¯ç©ºçš„
        if [ -f "README.md" ]; then
          readme_lines=$(wc -l < README.md)
          readme_chars=$(wc -c < README.md)
          echo "README.md: $readme_lines è¡Œ, $readme_chars å­—ç¬¦"
          
          if [ "$readme_lines" -gt 5 ]; then
            echo "âœ… README.md å†…å®¹å……è¶³"
          else
            echo "âš ï¸  README.md å¯èƒ½å†…å®¹å¤ªå°‘"
          fi
        fi
        
        # æ£€æŸ¥.gitignore
        if [ -f ".gitignore" ]; then
          ignore_lines=$(wc -l < .gitignore)
          echo ".gitignore: $ignore_lines è¡Œ"
        fi
        
        echo ""
        echo "3. ç¼–ç æ£€æŸ¥ï¼ˆç®€å•ç‰ˆï¼‰..."
        
        # æ£€æŸ¥æ–‡ä»¶ä¸æ˜¯Base64ç¼–ç 
        for file in README.md .gitignore LICENSE .env.example; do
          if [ -f "$file" ]; then
            # ç®€å•æ£€æŸ¥ï¼šæ–‡ä»¶æ˜¯å¦åŒ…å«å¯æ‰“å°å­—ç¬¦
            first_line=$(head -1 "$file")
            if echo "$first_line" | grep -q '^[A-Za-z0-9+/]*=*$' && [ "${#first_line}" -gt 50 ]; then
              echo "âš ï¸  $file å¯èƒ½æ˜¯Base64ç¼–ç "
            else
              echo "âœ… $file çœ‹èµ·æ¥æ˜¯æ­£å¸¸æ–‡æœ¬"
            fi
          fi
        done
        
        echo ""
        if [ "$all_exist" = true ]; then
          echo "ğŸ‰ åŸºç¡€éªŒè¯é€šè¿‡ï¼"
          echo "è¿™ä¸ªworkflowæ€»æ˜¯æˆåŠŸï¼Œç”¨äºéªŒè¯åŸºæœ¬æ–‡ä»¶ç»“æ„ã€‚"
          exit 0
        else
          echo "âŒ ç¼ºå°‘å¿…éœ€æ–‡ä»¶"
          exit 1
        fi
